<!DOCTYPE html>
<html lang="hu" layout:decorator="layouts/main">
<head>
<title>Tickets</title>
</head>
<body>

<div width="95%" layout:fragment="tickets">
<div class="container">
	
	<h2>Hibajegyek</h2>
	<a class="btn btn-default" th:href="@{'/workertickets/inprogress'}" role="button">Saját folyamatban</a>
	<a class="btn btn-default" th:href="@{'/workertickets/closed'}" role="button">Saját lezárt</a>
	<a class="btn btn-default" th:href="@{'/workertickets'}" role="button">Saját összes</a>
		<a class="btn btn-default" th:href="@{'/alltickets/inprogress'}" role="button">Összes folyamatban</a>
	<a class="btn btn-default" th:href="@{'/alltickets/closed'}" role="button">Összes lezárt</a>
	<a class="btn btn-default" th:href="@{'/alltickets'}" role="button">Összes</a>
	<a class="btn btn-warning" th:href="@{'/tickets'}" role="button">Gazdátlan</a>

   <table style="width:98%" class="table table-striped table-bordered table-hover">
   		<tr>
	        <td width="10%" >Id</td>
	        <td width="15%">Név</td>
	        <td width="35%">Bejelentés</td>
	        <td width="10%">Megoldó</td>
	        <td width="10%">Bejelentés kelte</td>
	        <td width="10%">Telefonszám</td>
	        <td width="10%">Cím</td>
    	</tr>
<!--         	<tr th:each="ticket : ${tickets}"   th:classappend="${ticketService.getDateDiff(#dates.createNow(), ticket.date,TimeUnit.MINUTES)} ? 'warning' : 'danger'">  -->
         	<tr th:each="ticket : ${tickets}"   th:classappend="${ticket.status eq 'closed'} ? 'success' : (${(#dates.year(#dates.createNow()) - #dates.year(ticket.startdate)) gt 0} ? 'danger' : (   ${( ((#dates.month(#dates.createNow())*30) + (#dates.day(#dates.createNow()))) - 
         																																			     (((#dates.month(ticket.startdate))*30) + (#dates.day(ticket.startdate))) ) gt 50} ? 'danger' :
         																																		  (   ${( ((#dates.month(#dates.createNow())*30) + (#dates.day(#dates.createNow()))) - 
         																																			     (((#dates.month(ticket.startdate))*30) + (#dates.day(ticket.startdate))) ) gt 15} ? 'warning' : '')) )"> 
        	
	        <p sec:authorize="hasAnyAuthority('ADMIN', 'EDITOR')"><td><a th:text="${#numbers.formatInteger(ticket.id,5)}"  th:href="@{'/tickets/' + ${ticket.id}}"   /></td></p>
	        <p sec:authorize="hasAuthority('USER')"><td><a th:text="${#numbers.formatInteger(ticket.id,5)}"  th:href="@{'/usertickets/' + ${ticket.id}}"   /></td></p>

	        <td th:utext="${ticket.client.name}"></td>
	        <td th:utext="${ticket.task}"></td>
	        <td>
	        <span th:if="${ticket.worker != null}" th:utext="${ticket.worker.name}"></span>
	        <span sec:authorize="hasAnyAuthority('EDITOR', 'ADMIN')" th:if="${ticket.worker == null}">
				    		<a th:href="@{'/vallalom/' + ${ticket.id}}">Vállalom</a>
				      </span>

	        </td>
	        <td th:text="${#dates.format(ticket.startdate, 'yyyy.MM.dd')}"></td>
	        <td th:utext="${ticket.client.phone}"></td>
	        <td  th:utext="${ticket.client.address}"></td>
        </tr>
   </table>


</div>
</div>

</body>
</html>